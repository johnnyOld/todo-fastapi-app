{% extends "base.html" %}
{% block title %}–ó–∞–¥–∞—á–∏{% endblock %}

{% block content %}
<style>
  .sticky-form {
    position: sticky;
    top: 80px;
    z-index: 1000;
  }
</style>

<!-- –•–µ–¥–µ—Ä -->
<nav class="navbar navbar-light bg-white border-bottom mb-3">
  <div class="container d-flex justify-content-between align-items-center">
    <h4 class="fw-bold m-0">üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏</h4>
    <div class="d-flex align-items-center gap-3">
      <span class="text-muted">–ü—Ä–∏–≤–µ—Ç, {{ username }}</span>
      <a href="/logout" class="btn btn-sm btn-outline-secondary">–í—ã–π—Ç–∏</a>
    </div>
  </div>
</nav>

<div class="container">
  <div class="row">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∑–∞–¥–∞—á–∏ -->
    <div class="col-lg-8">

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á -->
      {% if todos %}
        {% for todo in todos %}
          <div class="card mb-3 shadow-sm {% if todo.completed %}border-success{% endif %}">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h5 class="card-title {{ 'text-decoration-line-through text-muted' if todo.completed }}">{{ todo.title }}</h5>
                  {% if todo.description %}
                    <p class="card-text">{{ todo.description }}</p>
                  {% endif %}
                  <small class="text-muted">
                    {% if todo.created_at %}–°–æ–∑–¥–∞–Ω–æ: {{ todo.created_at.astimezone().strftime('%d.%m.%Y') }}{% endif %}
                    {% if todo.due_date %}| –î–µ–¥–ª–∞–π–Ω: {{ todo.due_date.astimezone().strftime('%d.%m.%Y') }}{% endif %}
                  </small>
                  <div class="mt-2">
                    {% if todo.completed %}
                      <span class="badge bg-success">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                    {% else %}
                      <span class="badge bg-warning text-dark">üïí –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                    {% endif %}
                    {% if todo.priority == 3 %}
                      <span class="badge bg-danger">üî• –í—ã—Å–æ–∫–∏–π</span>
                    {% elif todo.priority == 2 %}
                      <span class="badge bg-primary">‚ö† –°—Ä–µ–¥–Ω–∏–π</span>
                    {% else %}
                      <span class="badge bg-secondary">‚¨á –ù–∏–∑–∫–∏–π</span>
                    {% endif %}
                  </div>
                </div>
                <div class="d-flex flex-column gap-2">
                  <form method="post" action="/todo/{{ todo.id }}/toggle">
                    <button class="btn btn-sm btn-outline-success" type="submit">
                      {{ '‚Ü© –í —Ä–∞–±–æ—Ç—É' if todo.completed else '‚úì –ó–∞–≤–µ—Ä—à–∏—Ç—å' }}
                    </button>
                  </form>
                  <form method="post" action="/todo/{{ todo.id }}/delete">
                    <button class="btn btn-sm btn-outline-danger" type="submit">üóë –£–¥–∞–ª–∏—Ç—å</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="alert alert-info">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</div>
      {% endif %}
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Ñ–∏–ª—å—Ç—Ä –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
    <div class="col-lg-4">
      <!-- –§–∏–ª—å—Ç—Ä -->
      <div class="card mb-4 sticky-form">
        <div class="card-body">
          <form method="get">
            <label class="form-label">–§–∏–ª—å—Ç—Ä –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É</label>
            <select class="form-select" name="priority" onchange="this.form.submit()">
              <option value="">–í—Å–µ</option>
              <option value="3" {% if request.query_params.get('priority') == '3' %}selected{% endif %}>üî• –í—ã—Å–æ–∫–∏–π</option>
              <option value="2" {% if request.query_params.get('priority') == '2' %}selected{% endif %}>‚ö† –°—Ä–µ–¥–Ω–∏–π</option>
              <option value="1" {% if request.query_params.get('priority') == '1' %}selected{% endif %}>‚¨á –ù–∏–∑–∫–∏–π</option>
            </select>
          </form>
        </div>
      </div>

      <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ -->
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h5>
          <form method="post" action="/todo/create">
            <div class="mb-2">
              <input type="text" class="form-control" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
            </div>
            <div class="mb-2">
              <textarea class="form-control" name="description" rows="2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
            </div>
            <div class="mb-2">
              <input type="date" class="form-control" name="due_date">
            </div>
            <div class="mb-2">
              <select class="form-select" name="priority">
                <option value="1">‚¨á –ù–∏–∑–∫–∏–π</option>
                <option value="2">‚ö† –°—Ä–µ–¥–Ω–∏–π</option>
                <option value="3">üî• –í—ã—Å–æ–∫–∏–π</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary w-100">–î–æ–±–∞–≤–∏—Ç—å</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}